
; PICBASIC PRO(TM) Compiler 2.50a, (c) 1998, 2007 microEngineering Labs, Inc. All Rights Reserved.  
_USED			EQU	1

	INCLUDE	"C:\PBP\16F877A.INC"


; Define statements.
; C:\PBP\16F877A.BAS       	00018	DEFINE  CODE_SIZE 8
#define		CODE_SIZE		 8
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00017	DEFINE OSC 4
#define		OSC		 4
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00018	define LCD_DREG PORTC
#define		LCD_DREG		 PORTC
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00019	DEFINE LCD_DBIT 4
#define		LCD_DBIT		 4
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00020	define LCD_RSREG PORTC
#define		LCD_RSREG		 PORTC
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00021	DEFINE LCD_RSBIT 0
#define		LCD_RSBIT		 0
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00022	define LCD_EREG PORTC
#define		LCD_EREG		 PORTC
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00023	DEFINE LCD_EBIT 1
#define		LCD_EBIT		 1

RAM_START       		EQU	00020h
RAM_END         		EQU	001EFh
RAM_BANKS       		EQU	00004h
BANK0_START     		EQU	00020h
BANK0_END       		EQU	0007Fh
BANK1_START     		EQU	000A0h
BANK1_END       		EQU	000EFh
BANK2_START     		EQU	00110h
BANK2_END       		EQU	0016Fh
BANK3_START     		EQU	00190h
BANK3_END       		EQU	001EFh
EEPROM_START    		EQU	02100h
EEPROM_END      		EQU	021FFh

; C:\PBP\PBPPIC14.RAM      	00012	R0      VAR     WORD BANK0 SYSTEM       ' System Register
R0              		EQU	RAM_START + 000h
; C:\PBP\PBPPIC14.RAM      	00013	R1      VAR     WORD BANK0 SYSTEM       ' System Register
R1              		EQU	RAM_START + 002h
; C:\PBP\PBPPIC14.RAM      	00014	R2      VAR     WORD BANK0 SYSTEM       ' System Register
R2              		EQU	RAM_START + 004h
; C:\PBP\PBPPIC14.RAM      	00015	R3      VAR     WORD BANK0 SYSTEM       ' System Register
R3              		EQU	RAM_START + 006h
; C:\PBP\PBPPIC14.RAM      	00016	R4      VAR     WORD BANK0 SYSTEM       ' System Register
R4              		EQU	RAM_START + 008h
; C:\PBP\PBPPIC14.RAM      	00017	R5      VAR     WORD BANK0 SYSTEM       ' System Register
R5              		EQU	RAM_START + 00Ah
; C:\PBP\PBPPIC14.RAM      	00018	R6      VAR     WORD BANK0 SYSTEM       ' System Register
R6              		EQU	RAM_START + 00Ch
; C:\PBP\PBPPIC14.RAM      	00019	R7      VAR     WORD BANK0 SYSTEM       ' System Register
R7              		EQU	RAM_START + 00Eh
; C:\PBP\PBPPIC14.RAM      	00020	R8      VAR     WORD BANK0 SYSTEM       ' System Register
R8              		EQU	RAM_START + 010h
; C:\PBP\PBPPIC14.RAM      	00026	FLAGS   VAR     BYTE BANK0 SYSTEM       ' Static flags
FLAGS           		EQU	RAM_START + 012h
; C:\PBP\PBPPIC14.RAM      	00025	GOP     VAR     BYTE BANK0 SYSTEM       ' Gen Op Parameter
GOP             		EQU	RAM_START + 013h
; C:\PBP\PBPPIC14.RAM      	00022	RM1     VAR     BYTE BANK0 SYSTEM       ' Pin 1 Mask
RM1             		EQU	RAM_START + 014h
; C:\PBP\PBPPIC14.RAM      	00024	RM2     VAR     BYTE BANK0 SYSTEM       ' Pin 2 Mask
RM2             		EQU	RAM_START + 015h
; C:\PBP\PBPPIC14.RAM      	00021	RR1     VAR     BYTE BANK0 SYSTEM       ' Pin 1 Register
RR1             		EQU	RAM_START + 016h
; C:\PBP\PBPPIC14.RAM      	00023	RR2     VAR     BYTE BANK0 SYSTEM       ' Pin 2 Register
RR2             		EQU	RAM_START + 017h
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00001	'****************************************************************
T1              		EQU	RAM_START + 018h
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00001	'****************************************************************
T2              		EQU	RAM_START + 01Ah
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00001	'****************************************************************
T3              		EQU	RAM_START + 01Ch
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00015	actual VAR BYTE ;definir variable actualizar LCD
_actual          		EQU	RAM_START + 01Eh
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00014	cuenta VAR BYTE ;definir variable contador del timer
_cuenta          		EQU	RAM_START + 01Fh
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00011	hora VAR BYTE ;definir variable hora
_hora            		EQU	RAM_START + 020h
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00012	minut VAR BYTE ;definir variable minuto
_minut           		EQU	RAM_START + 021h
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00013	segun VAR BYTE ;definir variable segundos
_segun           		EQU	RAM_START + 022h
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00016	x VAR BYTE ;definir variable x contador
_x               		EQU	RAM_START + 023h
; C:\PBP\16F877A.BAS       	00022	PORTL   VAR     PORTB
_PORTL           		EQU	 PORTB
; C:\PBP\16F877A.BAS       	00023	PORTH   VAR     PORTC
_PORTH           		EQU	 PORTC
; C:\PBP\16F877A.BAS       	00024	TRISL   VAR     TRISB
_TRISL           		EQU	 TRISB
; C:\PBP\16F877A.BAS       	00025	TRISH   VAR     TRISC
_TRISH           		EQU	 TRISC
#define _START           	_PORTD??2
#define _F1              	_PORTD??0
#define _F2              	_PORTD??1
#define _PORTD??2        	 PORTD, 002h
#define _PORTD??0        	 PORTD, 000h
#define _PORTD??1        	 PORTD, 001h
#define _INTCON??2       	 INTCON, 002h
	INCLUDE	"RP.MAC"
	INCLUDE	"C:\PBP\PBPPIC14.LIB"


; C:\PBP\16F877A.BAS       	00012	BANK0   $0020, $007F
; C:\PBP\16F877A.BAS       	00013	BANK1   $00A0, $00EF
; C:\PBP\16F877A.BAS       	00014	BANK2   $0110, $016F
; C:\PBP\16F877A.BAS       	00015	BANK3   $0190, $01EF
; C:\PBP\16F877A.BAS       	00016	EEPROM  $2100, $21FF
; C:\PBP\16F877A.BAS       	00017	LIBRARY "PBPPIC14"
; C:\PBP\16F877A.BAS       	00018	DEFINE  CODE_SIZE 8

; C:\PBP\16F877A.BAS       	00020	        include "PIC14EXT.BAS"

; C:\PBP\16F877A.BAS       	00027	        include "PBPPIC14.RAM"
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00017	DEFINE OSC 4
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00018	define LCD_DREG PORTC
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00019	DEFINE LCD_DBIT 4
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00020	define LCD_RSREG PORTC
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00021	DEFINE LCD_RSBIT 0
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00022	define LCD_EREG PORTC
; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00023	DEFINE LCD_EBIT 1

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00029	TRISB=0
	MOVE?CB	000h, TRISB

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00030	hora = 0 
	MOVE?CB	000h, _hora

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00031	minut = 0
	MOVE?CB	000h, _minut

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00032	segun = 0
	MOVE?CB	000h, _segun

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00033	cuenta= 0
	MOVE?CB	000h, _cuenta

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00034	actual= 1
	MOVE?CB	001h, _actual

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00036	COND:

	LABEL?L	_COND	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00037	DISABLE
	DISABLE?	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00038	IF (F1=1 AND F1=1 AND START=1) THEN  INICIO
	CMPEQ?TCB	_F1, 001h, T1
	CMPEQ?TCB	_F1, 001h, T2
	LAND?BBW	T1, T2, T2
	CMPEQ?TCB	_START, 001h, T3
	LAND?WBL	T2, T3, _INICIO

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00039	INTCON.2 = 0
	MOVE?CT	000h, _INTCON??2

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00040	GOTO COND
	GOTO?L	_COND

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00042	CONTAR:

	LABEL?L	_CONTAR	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00044	INICIO:

	LABEL?L	_INICIO	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00045	OPTION_REG = %1010110 ;setea TMR0 configurando y habilita PORTB pullups
	MOVE?CB	056h, OPTION_REG

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00046	INTCON = %10100000 ;hablilita TMR0 interrupción interna
	MOVE?CB	0A0h, INTCON

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00047	ON INTERRUPT GOTO INTERRUP
	ONINT?LL	_INTERRUP, L00001

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00049	actualiza: IF actual = 1 THEN ;chequea si hay que actualizar LCD

	LABEL?L	_actualiza	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00049	actualiza: IF actual = 1 THEN ;chequea si hay que actualizar LCD
	ICALL?L	L00001
	CMPNE?BCL	_actual, 001h, L00002

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00050	LCDOUT $fe,1," ",dec2 hora,":",dec2 minut,":",DEC2 segun
	ICALL?L	L00001
	LCDOUT?C	0FEh
	LCDOUT?C	001h
	LCDOUT?C	020h
	LCDOUTCOUNT?C	002h
	LCDOUTNUM?B	_hora
	LCDOUTDEC?	
	LCDOUT?C	03Ah
	LCDOUTCOUNT?C	002h
	LCDOUTNUM?B	_minut
	LCDOUTDEC?	
	LCDOUT?C	03Ah
	LCDOUTCOUNT?C	002h
	LCDOUTNUM?B	_segun
	LCDOUTDEC?	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00051	actual = 0 ;pantalla actualizada
	ICALL?L	L00001
	MOVE?CB	000h, _actual

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00052	ENDIF
	ICALL?L	L00001
	LABEL?L	L00002	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00053	GOTO INICIO
	ICALL?L	L00001
	GOTO?L	_INICIO

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00055	incmin: minut = minut + 1

	LABEL?L	_incmin	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00055	incmin: minut = minut + 1
	ICALL?L	L00001
	ADD?BCB	_minut, 001h, _minut

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00056	IF minut >= 60 THEN minut=0
	ICALL?L	L00001
	CMPLT?BCL	_minut, 03Ch, L00004
	MOVE?CB	000h, _minut
	LABEL?L	L00004	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00057	GOTO pausa
	ICALL?L	L00001
	GOTO?L	_pausa

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00058	inchr: hora = hora + 1

	LABEL?L	_inchr	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00058	inchr: hora = hora + 1
	ICALL?L	L00001
	ADD?BCB	_hora, 001h, _hora

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00059	IF hora >= 24 THEN hora=0
	ICALL?L	L00001
	CMPLT?BCL	_hora, 018h, L00006
	MOVE?CB	000h, _hora
	LABEL?L	L00006	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00060	GOTO pausa
	ICALL?L	L00001
	GOTO?L	_pausa

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00061	pausa: FOR x = 1 TO 20 ; retardo de 200 mls

	LABEL?L	_pausa	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00061	pausa: FOR x = 1 TO 20 ; retardo de 200 mls
	ICALL?L	L00001
	MOVE?CB	001h, _x
	LABEL?L	L00008	
	CMPGT?BCL	_x, 014h, L00009

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00062	PAUSE 10 ;pasos de 10 mls para no perder interrupciones
	ICALL?L	L00001
	PAUSE?C	00Ah

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00063	NEXT x
	ICALL?L	L00001
	NEXT?BCL	_x, 001h, L00008
	LABEL?L	L00009	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00064	actual = 1 ;indica actualizar pantalla LCD
	ICALL?L	L00001
	MOVE?CB	001h, _actual

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00065	GOTO actualiza
	ICALL?L	L00001
	GOTO?L	_actualiza

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00067	DISABLE ;deshabilita interrupciones durante el proceso
	DISABLE?	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00068	interrup:

	LABEL?L	_INTERRUP	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00069	cuenta = cuenta + 1 ;cuenta las interrupciones del TMR0
	ADD?BCB	_cuenta, 001h, _cuenta

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00070	TMR0=4 ;resta 4 al contador de 256 del TMR0
	MOVE?CB	004h, TMR0

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00071	IF cuenta < 31 THEN reset ;31 cuentas (32256ms = 999936uS)
	CMPLT?BCL	_cuenta, 01Fh, _reset

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00072	cuenta = 0
	MOVE?CB	000h, _cuenta

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00073	segun = segun + 1
	ADD?BCB	_segun, 001h, _segun

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00074	IF segun >= 60 THEN
	CMPLT?BCL	_segun, 03Ch, L00010

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00075	segun = 0
	MOVE?CB	000h, _segun

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00076	minut = minut + 1
	ADD?BCB	_minut, 001h, _minut

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00077	IF minut >= 60 THEN
	CMPLT?BCL	_minut, 03Ch, L00012

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00078	minut = 0
	MOVE?CB	000h, _minut

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00079	hora = hora + 1
	ADD?BCB	_hora, 001h, _hora

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00080	IF hora >= 24 THEN
	CMPLT?BCL	_hora, 018h, L00014

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00081	hora = 0
	MOVE?CB	000h, _hora

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00082	ENDIF
	LABEL?L	L00014	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00083	ENDIF
	LABEL?L	L00012	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00084	ENDIF
	LABEL?L	L00010	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00085	actual = 1 ;actualizar LCD
	MOVE?CB	001h, _actual

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00086	reset:

	LABEL?L	_reset	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00087	INTCON.2 = 0 ;resetea la bandera de interrupción del TMR0
	MOVE?CT	000h, _INTCON??2

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00088	RESUME
	RESUME?	

; C:\USERS\DAVID ARAUJO\DESKTOP\SENSOR DE TIEMPO\RP.PBP	00089	END
	END?	

	END
